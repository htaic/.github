name: Service API Tests

on:
  workflow_call:
    inputs:
      environment_name:
        required: true
        description: "Name of the environment that the tests will run against"
        type: string 
        default: "dev"   
      working_dir:
        required: true
        description: "working directory"
        type: string
    secrets:
      TEST_USER_EMAIL:
        required: true
      TEST_USER_PASSWORD:
        required: true
    
env:
  TEST_ENV: ${{ inputs.environment_name }}
  TEST_USER_EMAIL: ${{ secrets.TEST_USER_EMAIL }}
  TEST_USER_PASSWORD: ${{ secrets.TEST_USER_PASSWORD }}

jobs:
  api-tests:
    runs-on: ubuntu-latest
    environment: 
      name: ${{ input.environment_name }}
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Install yarn
        run: npm install -g yarn

      - name: Install Dependencies
        run: yarn --cwd ${{ inputs.working_dir }}/ install

      - name: Run API tests
        run: yarn --cwd ${{ inputs.working_dir }}/ test:api
